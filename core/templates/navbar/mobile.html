{% load static wagtailcore_tags wagtailimages_tags %}
<div x-data="{ 
    menuStack: [],
    currentMenu: 'main',
    menus: {
        main: {
            title: 'Main Menu',
            items: [
                { label: 'Home', type: 'link', href: '/' },
                { label: 'Study', type: 'submenu', target: 'study' },
                { label: 'Admission', type: 'submenu', target: 'admission' },
                {% comment %} { label: 'About', type: 'submenu', target: 'about' } {% endcomment %}
            ]
        },
        study: {
            title: 'Study',
            items: [
                { label: 'Postgraduate', type: 'submenu', target: 'postgraduate' },
                { label: 'Undergraduate', type: 'submenu', target: 'undergraduate' },
                { label: 'High School (Year 10-12)', type: 'submenu', target: 'highSchool' },
                { label: 'English Language Center', type: 'submenu', target: 'elicos' }
            ]
        },
        postgraduate: {
            title: 'Postgraduate',
            items: [
                { label: 'Master of Information Technology (MIT)', type: 'link', href: '/study/postgraduate/master-of-information-technology/' },
                { label: 'Master of Business Admistration', type: 'link', href: '/study/postgraduate/master-of-business-administration/' },
                { label: 'Master of Professional Accounting (MPA)', type: 'link', href: '/study/postgraduate/master-of-professional-accounting/' },
                { label: 'Graduate Diploma in Information Technology', type: 'link', href: '/study/postgraduate/graduate-diploma-in-information-technology/' },
                { label: 'Graduate Diploma in Management', type: 'link', href: '/study/postgraduate/graduate-diploma-in-management/' },
                { label: 'Graduate Certificate in Information Technology', type: 'link', href: '/study/postgraduate/graduate-certificate-in-information-technology/' },
                { label: 'Graduate Certificate in Management', type: 'link', href: '/study/postgraduate/graduate-certificate-in-management/' }
            ]
        },
        undergraduate: {
            title: 'Undergraduate',
            items: [
                { label: 'Bachelor of Cyber Security', type: 'link', href: '/study/undergraduate/bachelor-of-cyber-security/' },
                { label: 'Bachelor of Information Systems', type: 'link', href: '/study/undergraduate/bachelor-of-information-systems/' },
                { label: 'Bachelor of Business (Accounting)', type: 'link', href: '/study/undergraduate/bachelor-of-business-accounting/' },
                { label: 'Bachelor of Business', type: 'link', href: '/study/undergraduate/bachelor-of-business/' },
                { label: 'Diploma of Business', type: 'link', href: '/study/undergraduate/diploma-of-business/' }
            ]
        },
        highSchool: {
            title: 'High School (Year 10-12)',
            items: [
                { label: 'Year 10 High School Program', type: 'link', href: '/study/high-school/year-10-high-school-program/' },
                { label: 'Victorian Certificate of Education (VCE)', type: 'link', href: '/study/high-school/victorian-certificate-of-education-vce/' }
            ]
        },
        elicos: {
            title: 'English Language Center',
            items: [
                { label: 'General English Course', type: 'link', href: '/study/english-language-center/general-english-course/' },
                { label: 'English for Academic Purposes (EAP)', type: 'link', href: '/study/english-language-center/english-for-academic-purposes/' },
                { label: 'English for Secondary School Preparation (ESSP)', type: 'link', href: '/study/english-language-center/english-for-secondary-school-preparation/' }
            ]
        },
        admission: {
            title: 'Admission',
            items: [
                { label: 'Fees', type: 'link', href: '/admissions/fees/' },
                { label: 'Intakes', type: 'link', href: '/admissions/intakes/' },
            ]
        }
    }
}" 
class="lg:hidden relative z-50">
    <!-- Fixed Header - 90px height -->
    <div class="fixed top-0 left-0 right-0 z-50 bg-white">
        <div x-show="studentType" class="w-full flex items-center bg-yellow-300 h-[30px] text-xs font-medium" x-cloak >
            <div class="container flex justify-center items-center">
                <p>You are viewing information for</p>&nbsp;
                <button 
                    @click="showGlobalStudentTypeModal = true" 
                    class="underline"
                    x-text="studentType === 'domestic' ? 'Domestic Students' : 'International Students'">
                </button>
            </div>
        </div>
        <!-- Top bar -->
        {% comment %} <div class="w-full bg-primary-dark text-white text-xs py-2">
            <div class="container">
                <ul class="flex justify-end items-center space-x-3">
                    <li><a href="https://selfservice.ozford.edu.au:9251/">Staffs</a></li>
                    <li><a href="/news-and-events/">News &amp; Events</a></li>
                    <li><a href="/about/contact-us/">Contact</a></li>
                    <li>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                        </svg>
                    </li>
                </ul>
            </div>
        </div> {% endcomment %}

        <!-- Header with logo and menu button -->
        <div class="flex justify-between items-center container py-4 border-b border-gray-200">
            <div>
                <a href="/" class="flex items-center">
                    {% image site_settings.header_logo original loading="lazy" class="w-36 h-auto" %}
                </a>
            </div>
            <div>
                <button @click="menuStack.length ? menuStack = [] : (menuStack = ['main'], currentMenu = 'main')" 
                        aria-label="Toggle Menu"
                        class="relative w-6 h-6">
                    <!-- Hamburger Icon -->
                    <svg x-show="!menuStack.length" 
                         xmlns="http://www.w3.org/2000/svg" 
                         fill="none" 
                         viewBox="0 0 24 24" 
                         stroke-width="1.5" 
                         stroke="currentColor" 
                         class="size-6"
                         x-transition:enter="transition-opacity duration-200"
                         x-transition:enter-start="opacity-0"
                         x-transition:enter-end="opacity-100">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                    </svg>
                    <!-- Close Icon -->
                    <svg x-show="menuStack.length" 
                         xmlns="http://www.w3.org/2000/svg" 
                         fill="none" 
                         viewBox="0 0 24 24" 
                         stroke-width="1.5" 
                         stroke="currentColor" 
                         class="size-6"
                         x-transition:enter="transition-opacity duration-200"
                         x-transition:enter-start="opacity-0"
                         x-transition:enter-end="opacity-100">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Menu Panel - Starts after header (90px) -->
    <div x-show="menuStack.length > 0" 
        class="fixed inset-0 z-40 mt-[90px] text-sm"
        @keydown.escape.window="menuStack = []">
        
        {% comment %} <!-- Backdrop -->
        <div class="fixed inset-0 bg-black/20" 
             @click="menuStack = []"
             x-transition:enter="transition-opacity duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition-opacity duration-300"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"></div> {% endcomment %}

        <!-- Sliding Menus Container -->
        <div class="fixed inset-0 overflow-hidden">
            <div class="absolute inset-0 overflow-hidden">
                <div class="fixed inset-y-0 right-0 flex w-full top-[90px]">
                    <div x-show="menuStack.length" 
                        @click.away="menuStack = []"
                        x-transition:enter="transform transition ease-in-out duration-500" 
                        x-transition:enter-start="translate-x-full" 
                        x-transition:enter-end="translate-x-0" 
                        x-transition:leave="transform transition ease-in-out duration-500" 
                        x-transition:leave-start="translate-x-0" 
                        x-transition:leave-end="translate-x-full" 
                        class="w-full">
            
            <!-- Menu Header -->
            
                <template x-if="menuStack.length > 1">
                    <div class="flex items-center justify-between py-3 bg-gray-100">
                        <div class="container">
                    <button @click="menuStack.pop(); currentMenu = menuStack[menuStack.length - 1]" 
                        class="flex items-center space-x-2 text-gray-800 font-semibold">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                          </svg>
                          
                        <span x-text="menus[currentMenu].title"></span>
                    </button>
                </div>
            </div>
                </template>
                {% comment %} <template x-if="menuStack.length === 1">
                    <span x-text="menus[currentMenu].title"></span>
                </template> {% endcomment %}
            

            <!-- Menu Items with Slide Transitions -->
            <div class="overflow-y-auto h-full bg-white">
                <div class="relative"
                     x-transition:enter="transform transition-transform duration-300 ease-out"
                     x-transition:enter-start="translate-x-full"
                     x-transition:enter-end="translate-x-0"
                     x-transition:leave="transform transition-transform duration-300 ease-out"
                     x-transition:leave-start="translate-x-0"
                     x-transition:leave-end="-translate-x-full">
                    <template x-for="item in menus[currentMenu].items" :key="item.label">
                        <div class="border-b border-gray-100">
                            <template x-if="item.type === 'link'">
                                <div class="container">
                                <a :href="item.href" 
                                    class="block py-3 hover:bg-gray-50"
                                    x-text="item.label"></a>
                                </div>
                            </template>
                            <template x-if="item.type === 'submenu'">
                                <div class="container">
                                <button @click="menuStack.push(item.target); currentMenu = item.target"
                                    class="flex items-center justify-between w-full py-3 hover:bg-gray-50">
                                    <span x-text="item.label"></span>
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                                    </svg>
                                </button>
                            </div>
                            </template>
                        </div>
                    </template>
                </div>
            </div>
        </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Spacer to push content below fixed header -->
    <div class="h-[90px]"></div>
</div>